<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React 19 useActionState Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #218838;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .success {
            color: #28a745;
            font-weight: bold;
            margin: 10px 0;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
            margin: 10px 0;
        }
        .persisted-data {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .persisted-data h4 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>React 19 useActionState with usePersistedState</h1>
    <p>This example demonstrates how to use React 19's <code>useActionState</code> hook with <code>usePersistedState</code> for form handling with persistence.</p>

    <div id="root"></div>

    <script src="https://unpkg.com/react@19/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@19/umd/react-dom.development.js"></script>
    <script type="module">
        import createPersistedState from '../../lib/index.js'
        import storage from '../../lib/storages/local-storage.js'

        const { useActionState } = React
        const { createRoot } = ReactDOM

        const [usePersistedState] = createPersistedState('react19_form_example', storage)

        function FormExample() {
            const [formData, setFormData] = usePersistedState('formData', {
                name: '',
                email: '',
                message: ''
            })

            async function submitAction(prevState, formData) {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000))

                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    message: formData.get('message')
                }

                // Validate data
                if (!data.name || !data.email || !data.message) {
                    return {
                        success: false,
                        error: 'All fields are required',
                        data: null
                    }
                }

                if (!data.email.includes('@')) {
                    return {
                        success: false,
                        error: 'Please enter a valid email address',
                        data: null
                    }
                }

                // Save to persisted state
                setFormData(data)

                return {
                    success: true,
                    error: null,
                    data,
                    timestamp: new Date().toLocaleString()
                }
            }

            const [state, formAction, isPending] = useActionState(submitAction, null)

            const handleClear = () => {
                setFormData({ name: '', email: '', message: '' })
            }

            return React.createElement('div', { className: 'container' }, [
                React.createElement('form', { key: 'form', action: formAction }, [
                    React.createElement('div', { key: 'name-group', className: 'form-group' }, [
                        React.createElement('label', { key: 'name-label', htmlFor: 'name' }, 'Name:'),
                        React.createElement('input', {
                            key: 'name-input',
                            id: 'name',
                            name: 'name',
                            type: 'text',
                            defaultValue: formData.name,
                            placeholder: 'Enter your name',
                            disabled: isPending
                        })
                    ]),
                    React.createElement('div', { key: 'email-group', className: 'form-group' }, [
                        React.createElement('label', { key: 'email-label', htmlFor: 'email' }, 'Email:'),
                        React.createElement('input', {
                            key: 'email-input',
                            id: 'email',
                            name: 'email',
                            type: 'email',
                            defaultValue: formData.email,
                            placeholder: 'Enter your email',
                            disabled: isPending
                        })
                    ]),
                    React.createElement('div', { key: 'message-group', className: 'form-group' }, [
                        React.createElement('label', { key: 'message-label', htmlFor: 'message' }, 'Message:'),
                        React.createElement('input', {
                            key: 'message-input',
                            id: 'message',
                            name: 'message',
                            type: 'text',
                            defaultValue: formData.message,
                            placeholder: 'Enter your message',
                            disabled: isPending
                        })
                    ]),
                    React.createElement('button', {
                        key: 'submit',
                        type: 'submit',
                        disabled: isPending
                    }, isPending ? 'Submitting...' : 'Submit Form')
                ]),

                React.createElement('button', {
                    key: 'clear',
                    type: 'button',
                    onClick: handleClear,
                    disabled: isPending,
                    style: { background: '#6c757d', marginLeft: '10px' }
                }, 'Clear Form'),

                state && state.success && React.createElement('div', {
                    key: 'success',
                    className: 'success'
                }, `Form submitted successfully at ${state.timestamp}!`),

                state && state.error && React.createElement('div', {
                    key: 'error',
                    className: 'error'
                }, state.error),

                React.createElement('div', { key: 'persisted', className: 'persisted-data' }, [
                    React.createElement('h4', { key: 'title' }, 'Persisted Form Data:'),
                    React.createElement('pre', { key: 'data' }, JSON.stringify(formData, null, 2))
                ]),

                React.createElement('p', { key: 'description' }, [
                    'This form uses ',
                    React.createElement('code', null, 'useActionState'),
                    ' for handling form submission with validation and loading states. ',
                    'The form data is automatically persisted in localStorage using ',
                    React.createElement('code', null, 'usePersistedState'),
                    '. Try refreshing the page to see the persistence in action!'
                ])
            ])
        }

        const root = createRoot(document.getElementById('root'))
        root.render(React.createElement(FormExample))
    </script>
</body>
</html>
